name: 🚀 Deploy Flask App to Render

on:
  push:
    branches:
      - main  # 🔥 Triggers workflow when pushing to `main`

jobs:
  deploy:
    name: 🔄 Deploy Flask App
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Checkout Code
      uses: actions/checkout@v3

    - name: 🐍 Set Up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"

    - name: 📦 Install Dependencies
      run: |
        pip install -r requirements.txt
        python -m spacy download en_core_web_sm


    - name: 🧠 Train & Export Model
      run: |
        python model/model.py  # ✅ Run the training script

    - name: 🐳 Build & Push Docker Image
      run: |
        docker build -t restaurant-sentiment .
        docker tag restaurant-sentiment:latest ${{ secrets.DOCKER_USERNAME }}/restaurant-sentiment:latest
        echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
        docker push ${{ secrets.DOCKER_USERNAME }}/restaurant-sentiment:latest
