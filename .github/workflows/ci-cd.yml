name: ğŸš€ Deploy Flask App to Render

on:
  push:
    branches:
      - main  # ğŸ”¥ Triggers workflow when pushing to `main`

jobs:
  deploy:
    name: ğŸ”„ Deploy Flask App
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3

    - name: ğŸ Set Up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"

    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install -r requirements.txt
        python -m spacy download en_core_web_sm


    - name: ğŸ§  Train & Export Model
      run: |
        python model/model.py  # âœ… Run the training script

    - name: ğŸ³ Build & Push Docker Image
      run: |
        docker build -t restaurant-sentiment .
        docker tag restaurant-sentiment:latest ${{ secrets.DOCKER_USERNAME }}/restaurant-sentiment:latest
        echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
        docker push ${{ secrets.DOCKER_USERNAME }}/restaurant-sentiment:latest
